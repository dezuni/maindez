<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پیش پرداخت کارت تخفیف</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">

    <style>
        body, h1, h2, h3, h4, h5, h6, p, div, span, label, input, textarea, button, a, li {
            font-family: 'Vazirmatn', 'Segoe UI', Tahoma, sans-serif !important;
            font-feature-settings: "cv01", "cv02", "cv03", "cv04", "cv05", "cv06", "cv07", "cv08", "cv09", "cv10";
        }

        #reservation-form {
            background: white;
            padding: 24px;
            border-radius: 14px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            margin: 20px auto 40px auto;
            max-width: 450px;
            width: 100%;
            display: none;
        }

        #reservation-form h3 {
            text-align: center;
            margin-bottom: 20px;
            color: #1e3a8a;
            font-weight: bold;
        }

        .formcontainer form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .formcontainer label {
            display: flex;
            flex-direction: column;
            font-weight: 500;
            color: #4b5563;
        }

        .formcontainer input {
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            direction: ltr;
            text-align: left;
            font-family: 'Vazirmatn', sans-serif;
        }

        .formcontainer input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }

        .captcha-section {
            padding: 12px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
            margin: 8px 0;
        }

        .formcontainer button {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-size: 1.05rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Vazirmatn', sans-serif;
        }

        .formcontainer button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.4);
        }

        .form-message {
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            margin-top: 12px;
            display: none;
        }

        .success {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #065f46;
        }

        .error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #b91c1c;
        }

        /* سبک‌های دیگر صفحه (اختیاری برای تست) */
        body { padding: 20px; background: #f5f7fa; }
        .dummy-card {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 12px;
            text-align: center;
        }
    </style>
</head>
<body>

    <!-- برای تست: دکمه شبیه‌سازی "رزرو کارت تخفیف" -->
    <div class="dummy-card">
        <p>برای تست، روی دکمه زیر کلیک کنید تا به فرم بروید:</p>
        <button onclick="scrollToForm()" style="padding:10px 20px; font-size:1rem;">رزرو کارت تخفیف</button>
    </div>

    <!-- فرم رزرو -->
    <div id="reservation-form">
        <h3>فرم ثبت‌نام و پیش‌پرداخت تخفیف</h3>
        <div class="formcontainer">
            <form id="DiscountForm">
                <label>نام و نام خانوادگی:
                    <input type="text" id="fullName_discount" required>
                </label>
                <label>شماره تماس (مانند مثال):
                    <input type="tel" id="phoneNumber_discount" inputmode="numeric" pattern="^09\d{9}$" placeholder="مثلاً: 09123456789" required>
                </label>
                <label>سه رقم آخر شماره دانشجویی/پرسنلی:
                    <input type="text" id="DiscountVerifCode" inputmode="numeric" placeholder="مثلاً: 123" pattern="\d{3}" maxlength="3" required>
                </label>

                <!-- کپچای ریاضی -->
                <div class="captcha-section" id="captchaQuestion">در حال بارگذاری...</div>
                <label for="captchaAnswer">جمع اعداد بالا را وارد کنید:
                    <input type="number" id="captchaAnswer" required>
                </label>

                <button type="submit">تأیید ثبت‌نام</button>
            </form>

            <div id="formMessage" class="form-message"></div>
        </div>
    </div>

    <script>
        // === تابع اسکرول به فرم ===
        function scrollToForm() {
            const form = document.getElementById('reservation-form');
            if (form) {
                form.style.display = 'block'; // نمایش فرم اگر پنهان بود
                form.scrollIntoView({ behavior: 'smooth', block: 'start' });
                generateCaptcha(); // بارگذاری کپچا
            }
        }

        // === کپچای ریاضی ===
        let correctCaptchaAnswer = 0;

        function generateCaptcha() {
            const a = Math.floor(Math.random() * 10) + 1; // 1 تا 10
            const b = Math.floor(Math.random() * 10) + 1; // 1 تا 10
            correctCaptchaAnswer = a + b;
            document.getElementById('captchaQuestion').textContent = `${a} + ${b} = ?`;
        }

        // === ارسال فرم ===
        document.getElementById('DiscountForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            // بررسی کپچا
            const userAnswer = parseInt(document.getElementById('captchaAnswer').value);
            if (userAnswer !== correctCaptchaAnswer) {
                showMessage('❌ پاسخ کپچا اشتباه است!', 'error');
                generateCaptcha(); // کپچای جدید
                return;
            }

            // گرفتن داده‌ها
            const fullName = document.getElementById('fullName_discount').value.trim();
            const phoneNumber = document.getElementById('phoneNumber_discount').value.trim();
            const studentCode = document.getElementById('DiscountVerifCode').value.trim();

            // اعتبارسنجی ساده
            if (!fullName || !phoneNumber || !studentCode) {
                showMessage('لطفاً همه فیلدها را پر کنید.', 'error');
                return;
            }

            // URL Web App خودتان را اینجا وارد کنید!
            const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzWn-9rh5vonVzKrjgk5e_vXPycUPQiQBL-IeQ4TOQcbGZk6ocK3Vj_m5xVl9mTOEZS/exec'; // ✅ جایگزین کنید!

            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // فقط برای Google Apps Script (محدودیت CORS)
                });

                // چون no-cors است، پاسخ را نمی‌توانیم بخوانیم، اما اگر فراخوانی شد، موفق فرض می‌شود
                showMessage('✅ درخواست شما با موفقیت ثبت شد!', 'success');
                document.getElementById('DiscountForm').reset();
                generateCaptcha(); // کپچای جدید برای جلوگیری از ارسال مجدد

            } catch (error) {
                console.error('خطا:', error);
                showMessage('❌ خطایی در ارسال رخ داد. لطفاً دوباره تلاش کنید.', 'error');
            }
        });

        function showMessage(text, type) {
            const el = document.getElementById('formMessage');
            el.textContent = text;
            el.className = 'form-message ' + type;
            el.style.display = 'block';
            setTimeout(() => {
                el.style.display = 'none';
            }, 5000);
        }

        // تولید کپچا در ابتدا (اختیاری)
        generateCaptcha();
    </script>

</body>
</html>
